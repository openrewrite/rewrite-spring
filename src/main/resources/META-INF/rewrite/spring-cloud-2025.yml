#
# Copyright 2025 the original author or authors.
# <p>
# Licensed under the Moderne Source Available License (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://docs.moderne.io/licensing/moderne-source-available-license
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.UpgradeSpringCloud_2025
displayName: Migrate to Spring Cloud 2025
description: Migrate applications to the latest Spring Cloud 2025 (Northfields) release.
tags:
  - spring
  - cloud
recipeList:
  # Do not chain previous versions of Spring Cloud; leave inclusion up to Spring Boot migrations to avoid duplicates
  - org.openrewrite.java.spring.cloud2025.DependencyUpgrades
  - org.openrewrite.java.spring.cloud2025.SpringCloudGatewayDeprecatedModulesAndStarters
  - org.openrewrite.java.spring.cloud2025.SpringCloudGatewayProperties
  - org.openrewrite.java.spring.cloud2025.SpringCloudGatewayWebfluxProperties
  - org.openrewrite.java.spring.cloud2025.SpringCloudGatewayProxyWebfluxProperties
  - org.openrewrite.java.spring.cloud2025.SpringCloudGatewayWebMvcProperties
  - org.openrewrite.java.spring.cloud2025.SpringCloudGatewayProxyWebMvcProperties

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.DependencyUpgrades
displayName: Upgrade dependencies to Spring Cloud 2025
description: Upgrade dependencies to Spring Cloud 2025 from prior 2024.x version.
tags:
  - spring
  - cloud
recipeList:
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: "*"
      newVersion: 4.3.x
      overrideManagedVersion: false
  - org.openrewrite.maven.UpgradeParentVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-starter-parent
      newVersion: 2025.0.x
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-dependencies
      newVersion: 2025.0.x
      overrideManagedVersion: false

  # circuitbreaker, kubernetes & task follow a different versioning scheme
  # https://docs.spring.io/spring-cloud-release/reference/2025.0/
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-starter-circuitbreaker-*
      newVersion: 3.3.x
      overrideManagedVersion: false
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-circuitbreaker-*
      newVersion: 3.3.x
      overrideManagedVersion: false
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-starter-kubernetes-*
      newVersion: 3.3.x
      overrideManagedVersion: false
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-kubernetes-*
      newVersion: 3.3.x
      overrideManagedVersion: false
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-starter-task-*
      newVersion: 3.3.x
      overrideManagedVersion: false
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework.cloud
      artifactId: spring-cloud-task-*
      newVersion: 3.3.x
      overrideManagedVersion: false

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.SpringCloudGatewayDeprecatedModulesAndStarters
displayName: Migrate to New Spring Cloud Gateway Modules and Starters
description: Migrate to new Spring Cloud Gateway modules and starters for Spring Cloud 2025.
tags:
  - spring
  - cloud
recipeList:
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.cloud
      oldArtifactId: spring-cloud-gateway-server
      newArtifactId: spring-cloud-gateway-server-webflux
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.cloud
      oldArtifactId: spring-cloud-gateway-server-mvc
      newArtifactId: spring-cloud-gateway-server-webmvc
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.cloud
      oldArtifactId: spring-cloud-starter-gateway
      newArtifactId: spring-cloud-starter-gateway-server-webflux
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.cloud
      oldArtifactId: spring-cloud-starter-gateway-mvc
      newArtifactId: spring-cloud-starter-gateway-server-webmvc
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.cloud
      oldArtifactId: spring-cloud-gateway-mvc
      newArtifactId: spring-cloud-gateway-proxyexchange-webmvc
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.cloud
      oldArtifactId: spring-cloud-gateway-webflux
      newArtifactId: spring-cloud-gateway-proxyexchange-webflux

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.SpringCloudGatewayProperties
displayName: Migrate Spring Cloud Gateway Properties
description: Migrate Spring Cloud Gateway properties for Spring Cloud 2025 release.
tags:
  - spring
  - cloud
recipeList:
  - org.openrewrite.java.spring.ChangeSpringPropertyKey:
      oldPropertyKey: spring.cloud.gateway
      newPropertyKey: spring.cloud.gateway.server.webflux
      except: ["proxy"]
  - org.openrewrite.java.spring.ChangeSpringPropertyKey:
      oldPropertyKey: spring.cloud.gateway.mvc
      newPropertyKey: spring.cloud.gateway.server.webmvc

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.SpringCloudGatewayWebfluxProperties
displayName: Migrate Spring Cloud Gateway Webflux Properties
description: Migrate Spring Cloud Gateway Webflux properties for Spring Cloud 2025 release.
tags:
  - spring
  - cloud
preconditions:
  - org.openrewrite.java.dependencies.search.ModuleHasDependency:
      groupIdPattern: org.springframework.cloud
      artifactIdPattern: spring-cloud-gateway-webflux
recipeList:
  - org.openrewrite.java.spring.ChangeSpringPropertyKey:
      oldPropertyKey: spring.cloud.gateway.proxy
      newPropertyKey: spring.cloud.gateway.proxy-exchange.webflux

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.SpringCloudGatewayProxyWebfluxProperties
displayName: Migrate Spring Cloud Gateway Proxy Webflux Properties
description: Migrate Spring Cloud Gateway Proxy Webflux properties for Spring Cloud 2025 release.
tags:
  - spring
  - cloud
preconditions:
  - org.openrewrite.java.dependencies.search.ModuleHasDependency:
      groupIdPattern: org.springframework.cloud
      artifactIdPattern: spring-cloud-gateway-proxyexchange-webflux
recipeList:
  - org.openrewrite.java.spring.ChangeSpringPropertyKey:
      oldPropertyKey: spring.cloud.gateway.proxy
      newPropertyKey: spring.cloud.gateway.proxy-exchange.webflux

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.SpringCloudGatewayWebMvcProperties
displayName: Migrate Spring Cloud Gateway WebMvc Properties
description: Migrate Spring Cloud Gateway WebMvc properties for Spring Cloud 2025 release.
tags:
  - spring
  - cloud
preconditions:
  - org.openrewrite.java.dependencies.search.ModuleHasDependency:
      groupIdPattern: org.springframework.cloud
      artifactIdPattern: spring-cloud-gateway-mvc
recipeList:
  - org.openrewrite.java.spring.ChangeSpringPropertyKey:
      oldPropertyKey: spring.cloud.gateway.proxy
      newPropertyKey: spring.cloud.gateway.proxy-exchange.webmvc

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.spring.cloud2025.SpringCloudGatewayProxyWebMvcProperties
displayName: Migrate Spring Cloud Gateway Proxy WebMvc Properties
description: Migrate Spring Cloud Gateway Proxy WebMvc properties for Spring Cloud 2025 release.
tags:
  - spring
  - cloud
preconditions:
  - org.openrewrite.java.dependencies.search.ModuleHasDependency:
      groupIdPattern: org.springframework.cloud
      artifactIdPattern: spring-cloud-gateway-proxyexchange-webmvc
recipeList:
  - org.openrewrite.java.spring.ChangeSpringPropertyKey:
      oldPropertyKey: spring.cloud.gateway.proxy
      newPropertyKey: spring.cloud.gateway.proxy-exchange-webmvc
